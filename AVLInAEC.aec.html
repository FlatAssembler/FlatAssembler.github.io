
<!doctype html>
<html>
<head>
    <title>AVLInAEC.aec - Syntax Highlighted in NodeJS</title>
    <style type="text/css">
    pre {
       font-size: 13px;
    }
    .LineNumber {
       color: #772200;
       font-weight: normal;
    }
    .Type {
       color: #775500;
       font-weight: bold;
    }
    .Keyword {
        color: #770000;
        font-weight: bold;
    }
    .Comment {
        color: #004444;
        font-weight: bold;
    }
    .Parenthesis {
        color: #333322;
        font-weight: bold;
    }
    .Operator {
        color: #770077;
        font-weight: bold;
    }
    .Constant {
        color: #006600;
        font-weight: bold;
    }
    .String {
        color: #003377;
    }
    </style>
</head>
<body>
<pre>   <span class="LineNumber">1</span> <span class="Comment">// AVLInAEC/AVLInAEC.aec
   <span class="LineNumber">2</span> </span><span class="Comment">// AVL demo with JavaScript API: expose keys buffer + setters/getters + render()
   <span class="LineNumber">3</span> </span><span class="Comment">// Uses same externals as Huffman demo for drawing.
   <span class="LineNumber">4</span> </span>
   <span class="LineNumber">5</span> #target WASI
   <span class="LineNumber">6</span> 
   <span class="LineNumber">7</span> <span class="Keyword">Function</span> noMoreFreeMemory<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
   <span class="LineNumber">8</span> <span class="Keyword">Function</span> segmentationFault<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
   <span class="LineNumber">9</span> <span class="Keyword">Function</span> printString<span class="Parenthesis">(</span><span class="Type">PointerToCharacter</span> string<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
  <span class="LineNumber">10</span> <span class="Keyword">Function</span> clearScreen<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
  <span class="LineNumber">11</span> <span class="Keyword">Function</span> setDiagramWidth<span class="Parenthesis">(</span><span class="Type">Integer32</span> width<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
  <span class="LineNumber">12</span> <span class="Keyword">Function</span> setDiagramHeight<span class="Parenthesis">(</span><span class="Type">Integer32</span> height<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
  <span class="LineNumber">13</span> <span class="Keyword">Function</span> drawLine<span class="Parenthesis">(</span><span class="Type">Integer32</span> x1<span class="Operator">,</span> <span class="Type">Integer32</span> y1<span class="Operator">,</span> <span class="Type">Integer32</span> x2<span class="Operator">,</span> <span class="Type">Integer32</span> y2<span class="Parenthesis">)</span>
  <span class="LineNumber">14</span>     <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
  <span class="LineNumber">15</span> <span class="Keyword">Function</span> drawRectangle<span class="Parenthesis">(</span><span class="Type">Integer32</span> x<span class="Operator">,</span> <span class="Type">Integer32</span> y<span class="Operator">,</span> <span class="Type">Integer32</span> width<span class="Operator">,</span> <span class="Type">Integer32</span> height<span class="Parenthesis">)</span>
  <span class="LineNumber">16</span>     <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
  <span class="LineNumber">17</span> <span class="Keyword">Function</span> drawText<span class="Parenthesis">(</span><span class="Type">Integer32</span> x<span class="Operator">,</span> <span class="Type">Integer32</span> y<span class="Operator">,</span> <span class="Type">PointerToCharacter</span> text<span class="Parenthesis">)</span>
  <span class="LineNumber">18</span>     <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Is</span> <span class="Keyword">External</span><span class="Keyword">;</span>
  <span class="LineNumber">19</span> 
  <span class="LineNumber">20</span> <span class="Type">Integer32</span> NDEBUG <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">21</span> 
  <span class="LineNumber">22</span> <span class="Comment">// --- String helpers (small set copied/adapted from Huffman demo) ---
  <span class="LineNumber">23</span> </span><span class="Keyword">Function</span> strlen<span class="Parenthesis">(</span><span class="Type">PointerToCharacter</span> str<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Integer32</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">24</span>   <span class="Keyword">If</span> str <span class="Operator">=</span> <span class="Constant">0</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span> <span class="Constant">0</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">25</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
  <span class="LineNumber">26</span>   <span class="Type">Integer32</span> length <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
  <span class="LineNumber">27</span>   <span class="Keyword">While</span> <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>str <span class="Operator">+</span> length<span class="Parenthesis">)</span> <span class="Keyword">Loop</span> <span class="Parenthesis">{</span> length <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">28</span>   <span class="Keyword">EndWhile</span><span class="Keyword">;</span>
  <span class="LineNumber">29</span>   <span class="Keyword">Return</span> length<span class="Keyword">;</span>
  <span class="LineNumber">30</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">31</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
  <span class="LineNumber">32</span> 
  <span class="LineNumber">33</span> <span class="Keyword">Function</span> strcpy<span class="Parenthesis">(</span><span class="Type">PointerToCharacter</span> dest<span class="Operator">,</span> <span class="Type">PointerToCharacter</span> src<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">34</span>   <span class="Keyword">While</span> <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>src<span class="Parenthesis">)</span> <span class="Keyword">Loop</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">35</span>     <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>dest<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>src<span class="Parenthesis">)</span><span class="Keyword">;</span>
  <span class="LineNumber">36</span>     dest <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">37</span>     src <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">38</span>   <span class="Parenthesis">}</span>
  <span class="LineNumber">39</span>   <span class="Keyword">EndWhile</span><span class="Keyword">;</span>
  <span class="LineNumber">40</span>   <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>dest<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
  <span class="LineNumber">41</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">42</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
  <span class="LineNumber">43</span> 
  <span class="LineNumber">44</span> <span class="Keyword">Function</span> strcat<span class="Parenthesis">(</span><span class="Type">PointerToCharacter</span> dest<span class="Operator">,</span> <span class="Type">PointerToCharacter</span> src<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">45</span>   strcpy<span class="Parenthesis">(</span>dest <span class="Operator">+</span> strlen<span class="Parenthesis">(</span>dest<span class="Parenthesis">)</span><span class="Operator">,</span> src<span class="Parenthesis">)</span><span class="Keyword">;</span>
  <span class="LineNumber">46</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">47</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
  <span class="LineNumber">48</span> 
  <span class="LineNumber">49</span> <span class="Keyword">Function</span> reverseString<span class="Parenthesis">(</span><span class="Type">PointerToCharacter</span> string<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">50</span>   <span class="Type">PointerToCharacter</span> pointerToLastCharacter <span class="Operator">:</span> <span class="Operator">=</span> string <span class="Operator">+</span> strlen<span class="Parenthesis">(</span>string<span class="Parenthesis">)</span> <span class="Operator">-</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">51</span>   <span class="Keyword">While</span> pointerToLastCharacter <span class="Operator">-</span> string <span class="Operator">&gt;</span> <span class="Constant">0</span> <span class="Keyword">Loop</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">52</span>     <span class="Type">Character</span> tmp <span class="Operator">:</span> <span class="Operator">=</span> <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>string<span class="Parenthesis">)</span><span class="Keyword">;</span>
  <span class="LineNumber">53</span>     <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>string<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>pointerToLastCharacter<span class="Parenthesis">)</span><span class="Keyword">;</span>
  <span class="LineNumber">54</span>     <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>pointerToLastCharacter<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> tmp<span class="Keyword">;</span>
  <span class="LineNumber">55</span>     string <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">56</span>     pointerToLastCharacter <span class="Operator">-</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">57</span>   <span class="Parenthesis">}</span>
  <span class="LineNumber">58</span>   <span class="Keyword">EndWhile</span><span class="Keyword">;</span>
  <span class="LineNumber">59</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">60</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
  <span class="LineNumber">61</span> 
  <span class="LineNumber">62</span> <span class="Keyword">Function</span> convertIntegerToString<span class="Parenthesis">(</span><span class="Type">PointerToCharacter</span> string<span class="Operator">,</span> <span class="Type">Integer32</span> number<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">63</span>   <span class="Type">Integer32</span> isNumberNegative <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
  <span class="LineNumber">64</span>   <span class="Keyword">If</span> number <span class="Operator">&lt;</span> <span class="Constant">0</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">65</span>     number <span class="Operator">:</span> <span class="Operator">=</span> <span class="Operator">-</span>number<span class="Keyword">;</span>
  <span class="LineNumber">66</span>     isNumberNegative <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">67</span>   <span class="Parenthesis">}</span>
  <span class="LineNumber">68</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
  <span class="LineNumber">69</span>   <span class="Type">Integer32</span> i <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
  <span class="LineNumber">70</span>   <span class="Keyword">While</span> number <span class="Operator">&gt;</span><span class="Operator">=</span> <span class="Constant">10</span> <span class="Keyword">Loop</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">71</span>     <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>string <span class="Operator">+</span> i<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="String">'0'</span> <span class="Operator">+</span> <span class="Operator">mod</span><span class="Parenthesis">(</span>number<span class="Operator">,</span> <span class="Constant">10</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
  <span class="LineNumber">72</span>     number <span class="Operator">/</span><span class="Operator">=</span> <span class="Constant">10</span><span class="Keyword">;</span>
  <span class="LineNumber">73</span>     i <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">74</span>   <span class="Parenthesis">}</span>
  <span class="LineNumber">75</span>   <span class="Keyword">EndWhile</span><span class="Keyword">;</span>
  <span class="LineNumber">76</span>   <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>string <span class="Operator">+</span> i<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="String">'0'</span> <span class="Operator">+</span> number<span class="Keyword">;</span>
  <span class="LineNumber">77</span>   i <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
  <span class="LineNumber">78</span>   <span class="Keyword">If</span> isNumberNegative <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>string <span class="Operator">+</span> i<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="String">'-'</span><span class="Keyword">;</span> i <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">79</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
  <span class="LineNumber">80</span>   <span class="Operator">ValueAt</span><span class="Parenthesis">(</span>string <span class="Operator">+</span> i<span class="Parenthesis">)</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
  <span class="LineNumber">81</span>   reverseString<span class="Parenthesis">(</span>string<span class="Parenthesis">)</span><span class="Keyword">;</span>
  <span class="LineNumber">82</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">83</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
  <span class="LineNumber">84</span> 
  <span class="LineNumber">85</span> <span class="Comment">// --- AVL node pool and helpers (pool like Huffman demo) ---
  <span class="LineNumber">86</span> </span><span class="Keyword">Structure</span> AVLNode <span class="Keyword">Consists</span> <span class="Keyword">Of</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">87</span>   <span class="Type">Integer32</span> key<span class="Keyword">;</span>
  <span class="LineNumber">88</span>   <span class="Type">PointerToAVLNode</span> leftChild<span class="Operator">,</span> rightChild<span class="Keyword">;</span>
  <span class="LineNumber">89</span>   <span class="Type">Integer32</span> height<span class="Keyword">;</span>
  <span class="LineNumber">90</span>   <span class="Type">Integer32</span> x<span class="Operator">,</span> y<span class="Keyword">;</span>
  <span class="LineNumber">91</span> <span class="Parenthesis">}</span>
  <span class="LineNumber">92</span> <span class="Keyword">EndStructure</span><span class="Keyword">;</span>
  <span class="LineNumber">93</span> 
  <span class="LineNumber">94</span> <span class="Type">InstantiateStructure</span> AVLNode avlNodes<span class="Parenthesis">[</span><span class="Constant">128</span><span class="Parenthesis">]</span><span class="Keyword">;</span>
  <span class="LineNumber">95</span> <span class="Type">Integer16</span> isAVLNodeUsed<span class="Parenthesis">[</span><span class="Constant">128</span><span class="Parenthesis">]</span><span class="Keyword">;</span>
  <span class="LineNumber">96</span> 
  <span class="LineNumber">97</span> <span class="Keyword">Function</span> isAVLNodeWithinBounds<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Integer32</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
  <span class="LineNumber">98</span>   <span class="Keyword">Return</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>avlNodes<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">&lt;</span><span class="Operator">=</span> node <span class="Operator">&lt;</span><span class="Operator">=</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>avlNodes<span class="Parenthesis">[</span><span class="Constant">128</span> <span class="Operator">-</span> <span class="Constant">1</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">and</span>
  <span class="LineNumber">99</span>       <span class="Operator">mod</span><span class="Parenthesis">(</span>node <span class="Operator">-</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>avlNodes<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="Operator">SizeOf</span><span class="Parenthesis">(</span>AVLNode<span class="Parenthesis">)</span><span class="Parenthesis">)</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">100</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">101</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">102</span> 
 <span class="LineNumber">103</span> <span class="Keyword">Function</span> newAVLNode<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToAVLNode</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">104</span>   <span class="Type">Integer16</span> i <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">105</span>   <span class="Keyword">While</span> i <span class="Operator">&lt;</span> <span class="Constant">128</span> <span class="Keyword">Loop</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">106</span>     <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>isAVLNodeUsed<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">107</span>       avlNodes<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span>.key <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">108</span>       avlNodes<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span>.leftChild <span class="Operator">:</span> <span class="Operator">=</span> avlNodes<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span>.rightChild <span class="Operator">:</span> <span class="Operator">=</span> <span class="Type">PointerToAVLNode</span><span class="Parenthesis">(</span><span class="Constant">0</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">109</span>       avlNodes<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span>.height <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">110</span>       avlNodes<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span>.x <span class="Operator">:</span> <span class="Operator">=</span> avlNodes<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span>.y <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">111</span>       isAVLNodeUsed<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">112</span>       <span class="Keyword">Return</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>avlNodes<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">113</span>     <span class="Parenthesis">}</span>
 <span class="LineNumber">114</span>     <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">115</span>     i <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">116</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">117</span>   <span class="Keyword">EndWhile</span><span class="Keyword">;</span>
 <span class="LineNumber">118</span>   noMoreFreeMemory<span class="Parenthesis">(</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">119</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">120</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">121</span> 
 <span class="LineNumber">122</span> <span class="Keyword">Function</span> freeAVLNode<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">123</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>isAVLNodeWithinBounds<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> segmentationFault<span class="Parenthesis">(</span><span class="Parenthesis">)</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">124</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">125</span>   isAVLNodeUsed<span class="Parenthesis">[</span><span class="Parenthesis">(</span>node <span class="Operator">-</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>avlNodes<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span> <span class="Operator">/</span> <span class="Operator">SizeOf</span><span class="Parenthesis">(</span>AVLNode<span class="Parenthesis">)</span><span class="Parenthesis">]</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">126</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">127</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">128</span> 
 <span class="LineNumber">129</span> <span class="Comment">// --- Height and rotation helpers ---
 <span class="LineNumber">130</span> </span><span class="Keyword">Function</span> nodeHeight<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Integer32</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">131</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span> <span class="Constant">0</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">132</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">133</span>   <span class="Keyword">Return</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>height<span class="Keyword">;</span>
 <span class="LineNumber">134</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">135</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">136</span> 
 <span class="LineNumber">137</span> <span class="Keyword">Function</span> max<span class="Parenthesis">(</span><span class="Type">Integer32</span> a<span class="Operator">,</span> <span class="Type">Integer32</span> b<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Integer32</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">138</span>   <span class="Keyword">If</span> a <span class="Operator">&gt;</span> b <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span> a<span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">139</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">140</span>   <span class="Keyword">Return</span> b<span class="Keyword">;</span>
 <span class="LineNumber">141</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">142</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">143</span> 
 <span class="LineNumber">144</span> <span class="Keyword">Function</span> updateHeight<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">145</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">146</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">147</span>   node<span class="Operator">-</span><span class="Operator">&gt;</span>height <span class="Operator">:</span> <span class="Operator">=</span> max<span class="Parenthesis">(</span>nodeHeight<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span><span class="Operator">,</span> nodeHeight<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span><span class="Parenthesis">)</span> <span class="Operator">+</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">148</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">149</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">150</span> 
 <span class="LineNumber">151</span> <span class="Keyword">Function</span> balanceFactor<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Integer32</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">152</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span> <span class="Constant">0</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">153</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">154</span>   <span class="Keyword">Return</span> nodeHeight<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span> <span class="Operator">-</span> nodeHeight<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">155</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">156</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">157</span> 
 <span class="LineNumber">158</span> <span class="Keyword">Function</span> rotateRight<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> y<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToAVLNode</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">159</span>   <span class="Type">Character</span> stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">32</span><span class="Parenthesis">]</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Parenthesis">{</span><span class="Constant">0</span><span class="Parenthesis">}</span><span class="Keyword">;</span>
 <span class="LineNumber">160</span>   strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"Right-rotate around "</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">161</span>   convertIntegerToString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">+</span> strlen<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Operator">,</span> y<span class="Operator">-</span><span class="Operator">&gt;</span>key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">162</span>   strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">".<b>\<i>n</i></b>"</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">163</span>   printString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">164</span> 
 <span class="LineNumber">165</span>   <span class="Type">PointerToAVLNode</span> x <span class="Operator">:</span> <span class="Operator">=</span> y<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Keyword">;</span>
 <span class="LineNumber">166</span>   <span class="Type">PointerToAVLNode</span> T2 <span class="Operator">:</span> <span class="Operator">=</span> x<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Keyword">;</span>
 <span class="LineNumber">167</span>   x<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> y<span class="Keyword">;</span>
 <span class="LineNumber">168</span>   y<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Operator">:</span> <span class="Operator">=</span> T2<span class="Keyword">;</span>
 <span class="LineNumber">169</span>   updateHeight<span class="Parenthesis">(</span>y<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">170</span>   updateHeight<span class="Parenthesis">(</span>x<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">171</span>   <span class="Keyword">Return</span> x<span class="Keyword">;</span>
 <span class="LineNumber">172</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">173</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">174</span> 
 <span class="LineNumber">175</span> <span class="Keyword">Function</span> rotateLeft<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> x<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToAVLNode</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">176</span>   <span class="Type">Character</span> stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">32</span><span class="Parenthesis">]</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Parenthesis">{</span><span class="Constant">0</span><span class="Parenthesis">}</span><span class="Keyword">;</span>
 <span class="LineNumber">177</span>   strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"Left-rotate around "</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">178</span>   convertIntegerToString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">+</span> strlen<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Operator">,</span> x<span class="Operator">-</span><span class="Operator">&gt;</span>key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">179</span>   strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">".<b>\<i>n</i></b>"</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">180</span>   printString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">181</span> 
 <span class="LineNumber">182</span>   <span class="Type">PointerToAVLNode</span> y <span class="Operator">:</span> <span class="Operator">=</span> x<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Keyword">;</span>
 <span class="LineNumber">183</span>   <span class="Type">PointerToAVLNode</span> T2 <span class="Operator">:</span> <span class="Operator">=</span> y<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Keyword">;</span>
 <span class="LineNumber">184</span>   y<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Operator">:</span> <span class="Operator">=</span> x<span class="Keyword">;</span>
 <span class="LineNumber">185</span>   x<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> T2<span class="Keyword">;</span>
 <span class="LineNumber">186</span>   updateHeight<span class="Parenthesis">(</span>x<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">187</span>   updateHeight<span class="Parenthesis">(</span>y<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">188</span>   <span class="Keyword">Return</span> y<span class="Keyword">;</span>
 <span class="LineNumber">189</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">190</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">191</span> 
 <span class="LineNumber">192</span> <span class="Comment">// --- AVL insert (no duplicates) ---
 <span class="LineNumber">193</span> </span><span class="Keyword">Function</span> avlInsert<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Operator">,</span> <span class="Type">Integer32</span> key<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToAVLNode</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">194</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">195</span>     <span class="Type">PointerToAVLNode</span> n <span class="Operator">:</span> <span class="Operator">=</span> newAVLNode<span class="Parenthesis">(</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">196</span>     n<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Operator">:</span> <span class="Operator">=</span> key<span class="Keyword">;</span>
 <span class="LineNumber">197</span>     n<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Operator">:</span> <span class="Operator">=</span> n<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> <span class="Type">PointerToAVLNode</span><span class="Parenthesis">(</span><span class="Constant">0</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">198</span>     n<span class="Operator">-</span><span class="Operator">&gt;</span>height <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">199</span>     <span class="Keyword">Return</span> n<span class="Keyword">;</span>
 <span class="LineNumber">200</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">201</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">202</span> 
 <span class="LineNumber">203</span>   <span class="Keyword">If</span> key <span class="Operator">&lt;</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">204</span>     node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Operator">:</span> <span class="Operator">=</span> avlInsert<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">,</span> key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">205</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">206</span>   <span class="Keyword">ElseIf</span> key <span class="Operator">&gt;</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">207</span>     node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> avlInsert<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">,</span> key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">208</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">209</span>   <span class="Keyword">Else</span> <span class="Parenthesis">{</span> <span class="Comment">// equal -> ignore duplicate
 <span class="LineNumber">210</span> </span>    <span class="Keyword">Return</span> node<span class="Keyword">;</span>
 <span class="LineNumber">211</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">212</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">213</span> 
 <span class="LineNumber">214</span>   updateHeight<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">215</span>   <span class="Type">Integer32</span> bf <span class="Operator">:</span> <span class="Operator">=</span> balanceFactor<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">216</span> 
 <span class="LineNumber">217</span>   <span class="Comment">// LL
 <span class="LineNumber">218</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&gt;</span> <span class="Constant">1</span> <span class="Operator">and</span> key <span class="Operator">&lt;</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">219</span>     <span class="Keyword">Return</span> rotateRight<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">220</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">221</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">222</span> 
 <span class="LineNumber">223</span>   <span class="Comment">// RR
 <span class="LineNumber">224</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&lt;</span> <span class="Operator">-</span><span class="Constant">1</span> <span class="Operator">and</span> key <span class="Operator">&gt;</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">225</span>     <span class="Keyword">Return</span> rotateLeft<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">226</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">227</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">228</span> 
 <span class="LineNumber">229</span>   <span class="Comment">// LR
 <span class="LineNumber">230</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&gt;</span> <span class="Constant">1</span> <span class="Operator">and</span> key <span class="Operator">&gt;</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">231</span>     node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Operator">:</span> <span class="Operator">=</span> rotateLeft<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">232</span>     <span class="Keyword">Return</span> rotateRight<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">233</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">234</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">235</span> 
 <span class="LineNumber">236</span>   <span class="Comment">// RL
 <span class="LineNumber">237</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&lt;</span> <span class="Operator">-</span><span class="Constant">1</span> <span class="Operator">and</span> key <span class="Operator">&lt;</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">238</span>     node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> rotateRight<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">239</span>     <span class="Keyword">Return</span> rotateLeft<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">240</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">241</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">242</span> 
 <span class="LineNumber">243</span>   <span class="Keyword">Return</span> node<span class="Keyword">;</span>
 <span class="LineNumber">244</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">245</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">246</span> 
 <span class="LineNumber">247</span> <span class="Comment">// --- AVL delete (new) ---
 <span class="LineNumber">248</span> </span><span class="Keyword">Function</span> minValueNode<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToAVLNode</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">249</span>   <span class="Type">PointerToAVLNode</span> current <span class="Operator">:</span> <span class="Operator">=</span> node<span class="Keyword">;</span>
 <span class="LineNumber">250</span>   <span class="Keyword">While</span> current<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Keyword">Loop</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">251</span>     current <span class="Operator">:</span> <span class="Operator">=</span> current<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Keyword">;</span>
 <span class="LineNumber">252</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">253</span>   <span class="Keyword">EndWhile</span><span class="Keyword">;</span>
 <span class="LineNumber">254</span>   <span class="Keyword">Return</span> current<span class="Keyword">;</span>
 <span class="LineNumber">255</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">256</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">257</span> 
 <span class="LineNumber">258</span> <span class="Keyword">Function</span> avlDelete<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> root<span class="Operator">,</span> <span class="Type">Integer32</span> key<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToAVLNode</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">259</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>root<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span> root<span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">260</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">261</span> 
 <span class="LineNumber">262</span>   <span class="Comment">// Standard BST delete
 <span class="LineNumber">263</span> </span>  <span class="Keyword">If</span> key <span class="Operator">&lt;</span> root<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">264</span>     root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Operator">:</span> <span class="Operator">=</span> avlDelete<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">,</span> key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">265</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">266</span>   <span class="Keyword">ElseIf</span> key <span class="Operator">&gt;</span> root<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">267</span>     root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> avlDelete<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">,</span> key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">268</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">269</span>   <span class="Keyword">Else</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">270</span>     <span class="Comment">// Node with only one child or no child
 <span class="LineNumber">271</span> </span>    <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">272</span>       <span class="Type">PointerToAVLNode</span> temp <span class="Operator">:</span> <span class="Operator">=</span> root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Keyword">;</span>
 <span class="LineNumber">273</span>       <span class="Comment">// free root
 <span class="LineNumber">274</span> </span>      freeAVLNode<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">275</span>       <span class="Keyword">Return</span> temp<span class="Keyword">;</span>
 <span class="LineNumber">276</span>     <span class="Parenthesis">}</span>
 <span class="LineNumber">277</span>     <span class="Keyword">ElseIf</span> <span class="Operator">not</span><span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">278</span>       <span class="Type">PointerToAVLNode</span> temp <span class="Operator">:</span> <span class="Operator">=</span> root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Keyword">;</span>
 <span class="LineNumber">279</span>       freeAVLNode<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">280</span>       <span class="Keyword">Return</span> temp<span class="Keyword">;</span>
 <span class="LineNumber">281</span>     <span class="Parenthesis">}</span>
 <span class="LineNumber">282</span>     <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">283</span> 
 <span class="LineNumber">284</span>     <span class="Comment">// Node with two children: Get inorder successor (smallest in the right subtree)
 <span class="LineNumber">285</span> </span>    <span class="Type">PointerToAVLNode</span> temp <span class="Operator">:</span> <span class="Operator">=</span> minValueNode<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">286</span>     <span class="Comment">// Copy the inorder successor's key to this node
 <span class="LineNumber">287</span> </span>    root<span class="Operator">-</span><span class="Operator">&gt;</span>key <span class="Operator">:</span> <span class="Operator">=</span> temp<span class="Operator">-</span><span class="Operator">&gt;</span>key<span class="Keyword">;</span>
 <span class="LineNumber">288</span>     <span class="Comment">// Delete the inorder successor
 <span class="LineNumber">289</span> </span>    root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> avlDelete<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">,</span> temp<span class="Operator">-</span><span class="Operator">&gt;</span>key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">290</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">291</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">292</span> 
 <span class="LineNumber">293</span>   <span class="Comment">// If the tree had only one node then return
 <span class="LineNumber">294</span> </span>  <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>root<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span> root<span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">295</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">296</span> 
 <span class="LineNumber">297</span>   <span class="Comment">// Update height
 <span class="LineNumber">298</span> </span>  updateHeight<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">299</span> 
 <span class="LineNumber">300</span>   <span class="Comment">// Get balance factor
 <span class="LineNumber">301</span> </span>  <span class="Type">Integer32</span> bf <span class="Operator">:</span> <span class="Operator">=</span> balanceFactor<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">302</span> 
 <span class="LineNumber">303</span>   <span class="Comment">// If unbalanced, there are 4 cases
 <span class="LineNumber">304</span> </span>  <span class="Comment">// Left Left
 <span class="LineNumber">305</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&gt;</span> <span class="Constant">1</span> <span class="Operator">and</span> balanceFactor<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span> <span class="Operator">&gt;</span><span class="Operator">=</span> <span class="Constant">0</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">306</span>     <span class="Keyword">Return</span> rotateRight<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">307</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">308</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">309</span> 
 <span class="LineNumber">310</span>   <span class="Comment">// Left Right
 <span class="LineNumber">311</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&gt;</span> <span class="Constant">1</span> <span class="Operator">and</span> balanceFactor<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span> <span class="Operator">&lt;</span> <span class="Constant">0</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">312</span>     root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Operator">:</span> <span class="Operator">=</span> rotateLeft<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">313</span>     <span class="Keyword">Return</span> rotateRight<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">314</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">315</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">316</span> 
 <span class="LineNumber">317</span>   <span class="Comment">// Right Right
 <span class="LineNumber">318</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&lt;</span> <span class="Operator">-</span><span class="Constant">1</span> <span class="Operator">and</span> balanceFactor<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span> <span class="Operator">&lt;</span><span class="Operator">=</span> <span class="Constant">0</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">319</span>     <span class="Keyword">Return</span> rotateLeft<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">320</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">321</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">322</span> 
 <span class="LineNumber">323</span>   <span class="Comment">// Right Left
 <span class="LineNumber">324</span> </span>  <span class="Keyword">If</span> bf <span class="Operator">&lt;</span> <span class="Operator">-</span><span class="Constant">1</span> <span class="Operator">and</span> balanceFactor<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span> <span class="Operator">&gt;</span> <span class="Constant">0</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">325</span>     root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Operator">:</span> <span class="Operator">=</span> rotateRight<span class="Parenthesis">(</span>root<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">326</span>     <span class="Keyword">Return</span> rotateLeft<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">327</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">328</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">329</span> 
 <span class="LineNumber">330</span>   <span class="Keyword">Return</span> root<span class="Keyword">;</span>
 <span class="LineNumber">331</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">332</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">333</span> 
 <span class="LineNumber">334</span> <span class="Comment">// --- Keys buffer (exposed to JS) ---
 <span class="LineNumber">335</span> </span><span class="Type">Integer32</span> keys<span class="Parenthesis">[</span><span class="Constant">128</span><span class="Parenthesis">]</span><span class="Keyword">;</span>
 <span class="LineNumber">336</span> <span class="Type">Integer32</span> numberOfKeys <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">337</span> <span class="Type">Character</span> insert_or_delete<span class="Parenthesis">[</span><span class="Constant">128</span><span class="Parenthesis">]</span><span class="Keyword">;</span>
 <span class="LineNumber">338</span> 
 <span class="LineNumber">339</span> <span class="Keyword">Function</span> getAddressOfKeys<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToInteger32</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">340</span>   <span class="Keyword">Return</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>keys<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">341</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">342</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">343</span> 
 <span class="LineNumber">344</span> <span class="Keyword">Function</span> getAddressOfInsertOrDelete<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">PointerToCharacter</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">345</span>   <span class="Keyword">Return</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>insert_or_delete<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">346</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">347</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">348</span> 
 <span class="LineNumber">349</span> <span class="Keyword">Function</span> setNumberOfKeys<span class="Parenthesis">(</span><span class="Type">Integer32</span> n<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">350</span>   <span class="Keyword">If</span> n <span class="Operator">&lt;</span> <span class="Constant">0</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> numberOfKeys <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span> <span class="Keyword">Return</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">351</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">352</span>   <span class="Keyword">If</span> n <span class="Operator">&gt;</span> <span class="Constant">128</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> numberOfKeys <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">128</span><span class="Keyword">;</span> <span class="Keyword">Return</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">353</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">354</span>   numberOfKeys <span class="Operator">:</span> <span class="Operator">=</span> n<span class="Keyword">;</span>
 <span class="LineNumber">355</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">356</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">357</span> 
 <span class="LineNumber">358</span> <span class="Keyword">Function</span> getNumberOfKeys<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Integer32</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">359</span>   <span class="Keyword">Return</span> numberOfKeys<span class="Keyword">;</span>
 <span class="LineNumber">360</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">361</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">362</span> 
 <span class="LineNumber">363</span> <span class="Keyword">Function</span> clearKeys<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">364</span>   numberOfKeys <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">365</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">366</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">367</span> 
 <span class="LineNumber">368</span> <span class="Comment">// --- Layout & drawing helpers (in-order X, depth-based Y) ---
 <span class="LineNumber">369</span> </span><span class="Type">Integer32</span> inorderCounter <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">370</span> 
 <span class="LineNumber">371</span> <span class="Keyword">Function</span> assignCoordinatesInorder<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Operator">,</span> <span class="Type">Integer32</span> depth<span class="Operator">,</span> <span class="Type">Integer32</span> horizontalSpacing<span class="Operator">,</span> <span class="Type">Integer32</span> verticalSpacing<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">372</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">373</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">374</span>   assignCoordinatesInorder<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">,</span> depth <span class="Operator">+</span> <span class="Constant">1</span><span class="Operator">,</span> horizontalSpacing<span class="Operator">,</span> verticalSpacing<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">375</span>   node<span class="Operator">-</span><span class="Operator">&gt;</span>x <span class="Operator">:</span> <span class="Operator">=</span> inorderCounter <span class="Operator">*</span> horizontalSpacing<span class="Keyword">;</span>
 <span class="LineNumber">376</span>   node<span class="Operator">-</span><span class="Operator">&gt;</span>y <span class="Operator">:</span> <span class="Operator">=</span> depth <span class="Operator">*</span> verticalSpacing<span class="Keyword">;</span>
 <span class="LineNumber">377</span>   inorderCounter <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">378</span>   assignCoordinatesInorder<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">,</span> depth <span class="Operator">+</span> <span class="Constant">1</span><span class="Operator">,</span> horizontalSpacing<span class="Operator">,</span> verticalSpacing<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">379</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">380</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">381</span> 
 <span class="LineNumber">382</span> <span class="Keyword">Structure</span> Maxima <span class="Keyword">Consists</span> <span class="Keyword">Of</span> <span class="Parenthesis">{</span> <span class="Type">Integer32</span> minimumX<span class="Operator">,</span> maximumX<span class="Keyword">;</span> <span class="Parenthesis">}</span> <span class="Keyword">EndStructure</span><span class="Keyword">;</span>
 <span class="LineNumber">383</span> 
 <span class="LineNumber">384</span> <span class="Keyword">Function</span> findMinMaxX<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Operator">,</span> <span class="Type">PointerToMaxima</span> m<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">385</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">386</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">387</span>   <span class="Keyword">If</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>x <span class="Operator">&lt;</span> m<span class="Operator">-</span><span class="Operator">&gt;</span>minimumX <span class="Keyword">Then</span> <span class="Parenthesis">{</span> m<span class="Operator">-</span><span class="Operator">&gt;</span>minimumX <span class="Operator">:</span> <span class="Operator">=</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>x<span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">388</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">389</span>   <span class="Keyword">If</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>x <span class="Operator">&gt;</span> m<span class="Operator">-</span><span class="Operator">&gt;</span>maximumX <span class="Keyword">Then</span> <span class="Parenthesis">{</span> m<span class="Operator">-</span><span class="Operator">&gt;</span>maximumX <span class="Operator">:</span> <span class="Operator">=</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>x<span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">390</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">391</span>   findMinMaxX<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">,</span> m<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">392</span>   findMinMaxX<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">,</span> m<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">393</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">394</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">395</span> 
 <span class="LineNumber">396</span> <span class="Keyword">Function</span> drawAVL<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Operator">,</span> <span class="Type">Integer32</span> offsetX<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">397</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">398</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">399</span>   <span class="Type">Integer32</span> drawX <span class="Operator">:</span> <span class="Operator">=</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>x <span class="Operator">-</span> offsetX<span class="Keyword">;</span>
 <span class="LineNumber">400</span>   <span class="Type">Integer32</span> drawY <span class="Operator">:</span> <span class="Operator">=</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>y<span class="Keyword">;</span>
 <span class="LineNumber">401</span>   drawRectangle<span class="Parenthesis">(</span>drawX<span class="Operator">,</span> drawY<span class="Operator">,</span> <span class="Constant">120</span><span class="Operator">,</span> <span class="Constant">60</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">402</span> 
 <span class="LineNumber">403</span>   <span class="Comment">// key text
 <span class="LineNumber">404</span> </span>  <span class="Type">Character</span> keyStr<span class="Parenthesis">[</span><span class="Constant">16</span><span class="Parenthesis">]</span><span class="Keyword">;</span>
 <span class="LineNumber">405</span>   keyStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">406</span>   strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>keyStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"Key: "</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">407</span>   convertIntegerToString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>keyStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">+</span> strlen<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>keyStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Operator">,</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>key<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">408</span>   drawText<span class="Parenthesis">(</span>drawX <span class="Operator">+</span> <span class="Constant">6</span><span class="Operator">,</span> drawY <span class="Operator">+</span> <span class="Constant">14</span><span class="Operator">,</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>keyStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">409</span> 
 <span class="LineNumber">410</span>   <span class="Comment">// height text
 <span class="LineNumber">411</span> </span>  <span class="Type">Character</span> heightStr<span class="Parenthesis">[</span><span class="Constant">16</span><span class="Parenthesis">]</span><span class="Keyword">;</span>
 <span class="LineNumber">412</span>   heightStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">413</span>   strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>heightStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"Height: "</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">414</span>   convertIntegerToString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>heightStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">+</span> strlen<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>heightStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Operator">,</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>height<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">415</span>   drawText<span class="Parenthesis">(</span>drawX <span class="Operator">+</span> <span class="Constant">6</span><span class="Operator">,</span> drawY <span class="Operator">+</span> <span class="Constant">30</span><span class="Operator">,</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>heightStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">416</span>   
 <span class="LineNumber">417</span>   <span class="Comment">// BalanceFactor text
 <span class="LineNumber">418</span> </span>  <span class="Type">Character</span> balanceFactorStr<span class="Parenthesis">[</span><span class="Constant">16</span><span class="Parenthesis">]</span><span class="Keyword">;</span>
 <span class="LineNumber">419</span>   balanceFactorStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span> <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">420</span>   strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>balanceFactorStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"BF: "</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">421</span>   convertIntegerToString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>balanceFactorStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">+</span> strlen<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>balanceFactorStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Operator">,</span> balanceFactor<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">422</span>   drawText<span class="Parenthesis">(</span>drawX <span class="Operator">+</span> <span class="Constant">6</span><span class="Operator">,</span> drawY <span class="Operator">+</span> <span class="Constant">30</span> <span class="Operator">+</span> <span class="Parenthesis">(</span><span class="Constant">30</span> <span class="Operator">-</span> <span class="Constant">14</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>balanceFactorStr<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">423</span> 
 <span class="LineNumber">424</span>   <span class="Keyword">If</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">425</span>     drawLine<span class="Parenthesis">(</span>drawX <span class="Operator">+</span> <span class="Constant">60</span><span class="Operator">,</span> drawY <span class="Operator">+</span> <span class="Constant">60</span><span class="Operator">,</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">-</span><span class="Operator">&gt;</span>x <span class="Operator">-</span> offsetX <span class="Operator">+</span> <span class="Constant">60</span><span class="Operator">,</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">-</span><span class="Operator">&gt;</span>y<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">426</span>     drawAVL<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Operator">,</span> offsetX<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">427</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">428</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">429</span>   <span class="Keyword">If</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">430</span>     drawLine<span class="Parenthesis">(</span>drawX <span class="Operator">+</span> <span class="Constant">60</span><span class="Operator">,</span> drawY <span class="Operator">+</span> <span class="Constant">60</span><span class="Operator">,</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">-</span><span class="Operator">&gt;</span>x <span class="Operator">-</span> offsetX <span class="Operator">+</span> <span class="Constant">60</span><span class="Operator">,</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">-</span><span class="Operator">&gt;</span>y<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">431</span>     drawAVL<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Operator">,</span> offsetX<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">432</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">433</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">434</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">435</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">436</span> 
 <span class="LineNumber">437</span> <span class="Comment">// --- Free tree ---
 <span class="LineNumber">438</span> </span><span class="Keyword">Function</span> freeAVLTree<span class="Parenthesis">(</span><span class="Type">PointerToAVLNode</span> node<span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">439</span>   <span class="Keyword">If</span> <span class="Operator">not</span><span class="Parenthesis">(</span>node<span class="Parenthesis">)</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span> <span class="Keyword">Return</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">440</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">441</span>   <span class="Keyword">If</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild <span class="Keyword">Then</span> <span class="Parenthesis">{</span> freeAVLTree<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>leftChild<span class="Parenthesis">)</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">442</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">443</span>   <span class="Keyword">If</span> node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild <span class="Keyword">Then</span> <span class="Parenthesis">{</span> freeAVLTree<span class="Parenthesis">(</span>node<span class="Operator">-</span><span class="Operator">&gt;</span>rightChild<span class="Parenthesis">)</span><span class="Keyword">;</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">444</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">445</span>   freeAVLNode<span class="Parenthesis">(</span>node<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">446</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">447</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">448</span> 
 <span class="LineNumber">449</span> <span class="Comment">// --- render() exposed to JS: build tree from keys[] and draw it ---
 <span class="LineNumber">450</span> </span><span class="Keyword">Function</span> render<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">451</span>   clearScreen<span class="Parenthesis">(</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">452</span>   <span class="Type">PointerToAVLNode</span> root <span class="Operator">:</span> <span class="Operator">=</span> <span class="Type">PointerToAVLNode</span><span class="Parenthesis">(</span><span class="Constant">0</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">453</span>   <span class="Type">Integer32</span> i <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">454</span>   <span class="Keyword">While</span> i <span class="Operator">&lt;</span> numberOfKeys <span class="Keyword">Loop</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">455</span>     <span class="Keyword">If</span> insert_or_delete<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span> <span class="Operator">=</span> <span class="String">'I'</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">456</span>       <span class="Type">Character</span> stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">32</span><span class="Parenthesis">]</span> <span class="Operator">:</span><span class="Operator">=</span> <span class="Parenthesis">{</span><span class="Constant">0</span><span class="Parenthesis">}</span><span class="Keyword">;</span>
 <span class="LineNumber">457</span>       strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"Inserting "</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">458</span>       convertIntegerToString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">+</span> strlen<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Operator">,</span> keys<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">459</span>       strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"...<b>\<i>n</i></b>"</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">460</span>       printString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">461</span> 
 <span class="LineNumber">462</span>       root <span class="Operator">:</span> <span class="Operator">=</span> avlInsert<span class="Parenthesis">(</span>root<span class="Operator">,</span> keys<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">463</span>     <span class="Parenthesis">}</span>
 <span class="LineNumber">464</span>     <span class="Keyword">ElseIf</span> insert_or_delete<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span> <span class="Operator">=</span> <span class="String">'D'</span> <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">465</span>       <span class="Type">Character</span> stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">32</span><span class="Parenthesis">]</span> <span class="Operator">:</span><span class="Operator">=</span> <span class="Parenthesis">{</span><span class="Constant">0</span><span class="Parenthesis">}</span><span class="Keyword">;</span>
 <span class="LineNumber">466</span>       strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"Deleting "</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">467</span>       convertIntegerToString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span> <span class="Operator">+</span> strlen<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Operator">,</span> keys<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">468</span>       strcat<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Operator">,</span> <span class="String">"...<b>\<i>n</i></b>"</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">469</span>       printString<span class="Parenthesis">(</span><span class="Operator">AddressOf</span><span class="Parenthesis">(</span>stringToBePrinted<span class="Parenthesis">[</span><span class="Constant">0</span><span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">470</span> 
 <span class="LineNumber">471</span>       root <span class="Operator">:</span> <span class="Operator">=</span> avlDelete<span class="Parenthesis">(</span>root<span class="Operator">,</span> keys<span class="Parenthesis">[</span>i<span class="Parenthesis">]</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">472</span>     <span class="Parenthesis">}</span>
 <span class="LineNumber">473</span>     <span class="Keyword">Else</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">474</span>       printString<span class="Parenthesis">(</span><span class="String">"The character array <b>\<i>"</i></b>insert_or_delete<b>\<i>"</i></b> can only contain characters 'I' and 'D'!<b>\<i>n</i></b>"</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">475</span>       <span class="Keyword">asm</span><span class="Parenthesis">(</span><span class="String">"unreachable"</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">476</span>     <span class="Parenthesis">}</span>
 <span class="LineNumber">477</span>     <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">478</span>     i <span class="Operator">+</span><span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">479</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">480</span>   <span class="Keyword">EndWhile</span><span class="Keyword">;</span>
 <span class="LineNumber">481</span> 
 <span class="LineNumber">482</span>   <span class="Comment">// Layout with some spacing; adjust constants as you prefer
 <span class="LineNumber">483</span> </span>  inorderCounter <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">1</span><span class="Keyword">;</span>
 <span class="LineNumber">484</span>   assignCoordinatesInorder<span class="Parenthesis">(</span>root<span class="Operator">,</span> <span class="Constant">0</span><span class="Operator">,</span> <span class="Constant">110</span><span class="Operator">,</span> <span class="Constant">90</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">485</span> 
 <span class="LineNumber">486</span>   <span class="Type">InstantiateStructure</span> Maxima globalMax<span class="Keyword">;</span>
 <span class="LineNumber">487</span>   globalMax.minimumX <span class="Operator">:</span> <span class="Operator">=</span> globalMax.maximumX <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">0</span><span class="Keyword">;</span>
 <span class="LineNumber">488</span>   <span class="Keyword">If</span> root <span class="Keyword">Then</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">489</span>     globalMax.minimumX <span class="Operator">:</span> <span class="Operator">=</span> root<span class="Operator">-</span><span class="Operator">&gt;</span>x<span class="Keyword">;</span>
 <span class="LineNumber">490</span>     globalMax.maximumX <span class="Operator">:</span> <span class="Operator">=</span> root<span class="Operator">-</span><span class="Operator">&gt;</span>x<span class="Keyword">;</span>
 <span class="LineNumber">491</span>     findMinMaxX<span class="Parenthesis">(</span>root<span class="Operator">,</span> <span class="Operator">AddressOf</span><span class="Parenthesis">(</span>globalMax<span class="Parenthesis">)</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">492</span>   <span class="Parenthesis">}</span>
 <span class="LineNumber">493</span>   <span class="Keyword">EndIf</span><span class="Keyword">;</span>
 <span class="LineNumber">494</span> 
 <span class="LineNumber">495</span>   <span class="Type">Integer32</span> margin <span class="Operator">:</span> <span class="Operator">=</span> <span class="Constant">20</span><span class="Keyword">;</span>
 <span class="LineNumber">496</span>   <span class="Type">Integer32</span> diagramWidth <span class="Operator">:</span> <span class="Operator">=</span> <span class="Parenthesis">(</span>globalMax.maximumX <span class="Operator">-</span> globalMax.minimumX<span class="Parenthesis">)</span> <span class="Operator">+</span> <span class="Constant">120</span> <span class="Operator">+</span> margin <span class="Operator">*</span> <span class="Constant">2</span><span class="Keyword">;</span>
 <span class="LineNumber">497</span>   <span class="Type">Integer32</span> diagramHeight <span class="Operator">:</span> <span class="Operator">=</span> <span class="Parenthesis">(</span>nodeHeight<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span> <span class="Operator">+</span> <span class="Constant">1</span><span class="Parenthesis">)</span> <span class="Operator">*</span> <span class="Constant">90</span> <span class="Operator">+</span> margin<span class="Keyword">;</span>
 <span class="LineNumber">498</span> 
 <span class="LineNumber">499</span>   setDiagramWidth<span class="Parenthesis">(</span>diagramWidth<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">500</span>   setDiagramHeight<span class="Parenthesis">(</span>diagramHeight<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">501</span> 
 <span class="LineNumber">502</span>   drawAVL<span class="Parenthesis">(</span>root<span class="Operator">,</span> globalMax.minimumX <span class="Operator">-</span> margin<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">503</span> 
 <span class="LineNumber">504</span>   freeAVLTree<span class="Parenthesis">(</span>root<span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">505</span>   printString<span class="Parenthesis">(</span><span class="String">"AVL rendered.<b>\<i>n</i></b>"</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">506</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">507</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">508</span> 
 <span class="LineNumber">509</span> <span class="Comment">// Keep main for compatibility (just calls render), but JS can call render() directly.
 <span class="LineNumber">510</span> </span><span class="Keyword">Function</span> main<span class="Parenthesis">(</span><span class="Parenthesis">)</span> <span class="Keyword">Which</span> <span class="Keyword">Returns</span> <span class="Type">Nothing</span> <span class="Keyword">Does</span> <span class="Parenthesis">{</span>
 <span class="LineNumber">511</span>   render<span class="Parenthesis">(</span><span class="Parenthesis">)</span><span class="Keyword">;</span>
 <span class="LineNumber">512</span> <span class="Parenthesis">}</span>
 <span class="LineNumber">513</span> <span class="Keyword">EndFunction</span><span class="Keyword">;</span>
 <span class="LineNumber">514</span> 
</pre>
</body>
</html>
